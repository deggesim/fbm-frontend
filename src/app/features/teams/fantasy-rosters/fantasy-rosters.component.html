<form [formGroup]="form" class="needs-validation" novalidate>
  <fieldset class="fieldset">
    <legend class="legend"><fa-icon icon="list" class="icon-padding"></fa-icon>Fantasquadra</legend>

    <div fxLayout="row wrap" fxLayoutAlign="space-between">
      <div fxFlex="100">
        <div class="mb-3">
          <label for="fantasyTeam" class="control-label">Fantasquadra</label>
          <ng-select
            id="fantasyTeam"
            [items]="fantasyTeams"
            bindLabel="name"
            formControlName="fantasyTeam"
            clearAllText="Elimina"
            (change)="selectFantasyTeam($event)"
          >
          </ng-select>
        </div>
      </div>
    </div>

    <div fxLayout="row wrap" fxLayoutAlign="space-around" *ngIf="fantasyTeamSelected">
      <div>Crediti residui: {{ fantasyTeamSelected.initialBalance - fantasyTeamSelected.balancePenalty - fantasyTeamSelected.outgo }}</div>
      <div>Contratti stipulati: {{ fantasyTeamSelected.totalContracts }}</div>
      <div>Giocatori nel roster: {{ fantasyTeamSelected.playersInRoster }}</div>
      <div>Visti spesi: {{ fantasyTeamSelected.extraPlayers }}</div>
    </div>

    <ng-container *ngIf="fantasyRosters && fantasyRosters.length > 0; else empty">
      <hr />

      <div class="table-responsive">
        <table class="table table-hover" aria-label="Fantasy roster">
          <thead class="table-dark">
            <tr>
              <th id="name">Nome</th>
              <th fxHide.lt-sm id="status">Status</th>
              <th fxHide.lt-sm id="contract">Contratto</th>
              <th fxHide.lt-sm id="yearContract">Anno di contratto</th>
              <th fxHide.lt-sm id="role">Ruolo</th>
              <th fxHide.gt-sm id="role">R.</th>
              <th fxHide.lt-sm id="team">Squadra</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let fr of fantasyRosters" class="table-secondary">
              <td [appPlayerStatus]="fr" class="text-nowrap">{{ fr.roster.player.name }}</td>
              <td fxHide.lt-sm [appPlayerStatus]="fr">{{ fr.status }}</td>
              <td fxHide.lt-sm [appPlayerStatus]="fr">{{ fr.contract != null ? fr.contract : 'D' }}</td>
              <td fxHide.lt-sm [appPlayerStatus]="fr">{{ fr.yearContract }}</td>
              <td fxHide.lt-sm [appPlayerStatus]="fr">{{ fr.roster.player.role }}</td>
              <td fxHide.gt-sm [appPlayerStatus]="fr">{{ fr.roster.player.role | roleShort }}</td>
              <td fxHide.lt-sm [appPlayerStatus]="fr">{{ fr.roster.team.fullName }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <ng-container *ngIf="htmlHistory && htmlHistory.length > 0">
        <hr />
        <h4>Storico</h4>

        <ul class="list-group list-group-numbered">
          <li class="list-group-item d-flex justify-content-between align-items-start" *ngFor="let item of history">
            <ng-container *ngIf="'name'; in: item; else: fth">
              <div class="ms-2 me-auto">
                <!-- player -->
                <div class="fw-bold">
                  {{ (item | castToFantasyRosterHistory).realFixture.name }} - {{ (item | castToFantasyRosterHistory).operation }} -
                  {{ (item | castToFantasyRosterHistory).name }}
                </div>
                <div class="table">
                  <table class="table table-hover" aria-label="Storico">
                    <thead class="table-dark">
                      <tr>
                        <th fxHide.lt-sm id="status">Status</th>
                        <th fxHide.lt-sm id="contract">Contratto</th>
                        <th fxHide.lt-sm id="yearContract">Anno di contratto</th>
                        <th fxHide.lt-sm id="role">Ruolo</th>
                      </tr>
                    </thead>

                    <tbody>
                      <tr class="table-secondary">
                        <td fxHide.lt-sm>{{ (item | castToFantasyRosterHistory).status }}</td>
                        <td fxHide.lt-sm>
                          {{ (item | castToFantasyRosterHistory).contract != null ? (item | castToFantasyRosterHistory).contract : 'D' }}
                        </td>
                        <td fxHide.lt-sm>{{ (item | castToFantasyRosterHistory).yearContract }}</td>
                        <td fxHide.lt-sm>{{ (item | castToFantasyRosterHistory).role }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </ng-container>
            <ng-template #fth>
              <div class="ms-2 me-auto">
                fth
                <!-- team -->
                <div class="fw-bold">
                  {{ (item | castToFantasyTeamHistory).realFixture.name }}
                </div>
                <div class="table">
                  <table class="table table-hover" aria-label="Storico">
                    <thead class="table-dark">
                      <tr>
                        <th id="initialBalance">Bilancio</th>
                        <th id="outgo">Crediti spesi</th>
                        <th id="remainingCredits">Crediti residui</th>
                        <th id="totalContracts"># Contratti</th>
                        <th id="playersInRoster"># Giocatori</th>
                        <th id="extraPlayers">Visti spesi</th>
                        <th id="pointsPenalty">Punti di penalit√†</th>
                        <th id="balancePenalty">Malus crediti</th>
                      </tr>
                    </thead>

                    <tbody>
                      <tr class="table-secondary">
                        <td>{{ (item | castToFantasyTeamHistory).initialBalance }}</td>
                        <td>{{ (item | castToFantasyTeamHistory).outgo }}</td>
                        <td>
                          {{
                            (item | castToFantasyTeamHistory).initialBalance -
                              (item | castToFantasyTeamHistory).balancePenalty -
                              (item | castToFantasyTeamHistory).outgo
                          }}
                        </td>
                        <td>{{ (item | castToFantasyTeamHistory).totalContracts }}</td>
                        <td>{{ (item | castToFantasyTeamHistory).playersInRoster }}</td>
                        <td>{{ (item | castToFantasyTeamHistory).extraPlayers }}</td>
                        <td>{{ (item | castToFantasyTeamHistory).pointsPenalty }}</td>
                        <td>{{ (item | castToFantasyTeamHistory).balancePenalty }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <span class="badge bg-primary rounded-pill">Saldo operazione: {{ (item | castToFantasyTeamHistory).outgo }}</span>
            </ng-template>
          </li>
        </ul>
      </ng-container>
    </ng-container>

    <ng-template #empty>
      <div class="p-3">
        <h4>Nessun giocatore presente</h4>
      </div>
    </ng-template>
  </fieldset>
</form>
